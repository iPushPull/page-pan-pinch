var PagePanPinch=function(){function PagePanPinch(options){var _this=this;if(this.version="0.15",this._options={prefix:"ppp",bounds:"",contentView:"",contentScroll:"",contentZoom:"",page:"",pageHasChildren:!1,debug:"",zoomCss:!1,zoomIncrements:.25,zoomFit:!0,scrollBars:!1,scrollBarWidth:8,scrollBarsInset:!1,disablePan:!1,onTap:function(pt,ev){},onDoubleTap:function(pt,ev){}},this._scrollBars=!1,this._scale={last:1,current:1,min:.5,max:2,width:0,height:0},this._pos={friction:.8,updateInterval:50,x:{last:0,current:0,vel:0,delta:0},y:{last:0,current:0,vel:0,delta:0}},this._scrollBarElements={scrollX:{axis:"x",element:null,type:"scroller",className:"scroll-x",zIndex:100,drag:!1,pos:{}},scrollY:{axis:"y",element:null,type:"scroller",className:"scroll-y",zIndex:100,drag:!1,pos:{}},trackX:{axis:"x",element:null,type:"track",className:"track-x",zIndex:10,pos:{}},trackY:{axis:"y",element:null,type:"track",className:"track-y",zIndex:10,pos:{}}},this._scrollParams={x:{parent:"trackX",element:"scrollX",pos:"mouseX",unit:"width",dir:"left"},y:{parent:"trackY",element:"scrollY",pos:"mouseY",unit:"height",dir:"top"}},this._scrollEvents=!1,this._isScrolling=!1,this._init=!1,this._initScale=!1,this.initInterval=function(){_this._options.pageHasChildren&&!_this._page.childNodes.length||(clearInterval(_this._initInterval),_this._initInterval=void 0,_this.setupContainers(),_this._initScale&&_this.setMaxMinScale(),_this.setupScrollbars(),_this.setupTouch(),_this.update(),_this._initScale&&_this.updateContentScroll(),_this._init=!0)},this._eventScroll=function(evt){_this._isScrolling||(_this._pos.x.current=_this._contentView.scrollLeft,_this._pos.y.current=_this._contentView.scrollTop,_this.update())},this._eventScrollWheel=function(evt){if(_this._scrollBars&&_this._scrollEvents){_this._isScrolling=!0,_this._eventScrollWheelTimer&&(clearTimeout(_this._eventScrollWheelTimer),_this._eventScrollWheelTimer=void 0);var delta=Math.max(-1,Math.min(1,evt.wheelDelta||-evt.detail)),axis=_this._scrollEvents.indexOf("y")>-1?"y":"x",scroll="scroll"+(_this._scrollParams[axis].dir.charAt(0).toUpperCase()+_this._scrollParams[axis].dir.slice(1));_this._pos[axis].current+=20*delta*-1,_this.update(),_this._pos[axis].current=_this._pos[axis].last=_this._contentView[scroll],_this._eventScrollWheelTimer=setTimeout(function(){_this._isScrolling=!1},50),evt.preventDefault()}},this._eventScrollMouseMove=function(evt){_this._isScrolling=!0;for(var e in _this._scrollBarElements)if(_this._scrollBarElements.hasOwnProperty(e)){var scroller=_this._scrollBarElements[e];if(!0===scroller.drag){var paramsAxis=_this._scrollParams[scroller.axis],offset=evt[scroller.axis]-scroller.pos[paramsAxis.pos],pos=scroller.pos[scroller.axis]+offset;pos<0&&(pos=0);var distance=parseFloat(scroller.element.style[paramsAxis.unit]),distanceRemainder=_this._scrollBounds[paramsAxis.unit]-distance,maxOffset=_this._scrollBounds[paramsAxis.dir]+distanceRemainder;pos>maxOffset&&(pos=maxOffset);var scroll_1=pos;_this._pos[scroller.axis].current=_this._pos[scroller.axis].last=scroll_1*(_this._scrollRect[paramsAxis.unit]/_this._scrollBounds[paramsAxis.unit]),_this.update()}}},this._eventScrollMouseUp=function(evt){_this._isScrolling=!1;for(var e in _this._scrollBarElements)_this._scrollBarElements.hasOwnProperty(e)&&(_this._scrollBarElements[e].drag=!1)},this._eventPinchStart=function(ev){_this._scale.last=_this._scale.current,_this.clearPanTimer(),_this.updateContentScroll()},this._eventPinchMove=function(ev){_this._scale.current=_this._scale.last*ev.scale,_this.update()},this._eventPinchEnd=function(ev){_this._scale.last=_this._scale.current,_this.update(),_this.updateContentScroll()},this._eventTap=function(ev){1===ev.tapCount?_this._options.onTap(_this,ev):2===ev.tapCount&&_this._options.onDoubleTap(_this,ev)},this._eventPanStart=function(ev){_this._scale.last=_this._scale.current,_this.clearPanTimer(),_this.updateContentScroll()},this._eventPanMove=function(ev){_this._pos.x.current=_this._pos.x.last+-1*ev.deltaX,_this._pos.y.current=_this._pos.y.last+-1*ev.deltaY,_this.update()},this._eventPanEnd=function(ev){_this._pos.x.last=_this._pos.x.current,_this._pos.y.last=_this._pos.y.current,_this._pos.x.delta=-1*ev.deltaX,_this._pos.y.delta=-1*ev.deltaY,Math.abs(ev.velocity)>.2&&(_this._panTimer=setInterval(function(){_this.updatePanVel()},_this._pos.updateInterval))},void 0===window.Hammer)throw"Hammer JS not found";for(var i in options)options.hasOwnProperty(i)&&(this._options[i]=options[i]);if(this._bounds="string"==typeof this._options.bounds?document.getElementById(this._options.bounds):this._options.bounds,this._contentView="string"==typeof this._options.contentView?document.getElementById(this._options.contentView):this._options.contentView,this._contentScroll="string"==typeof this._options.contentScroll?document.getElementById(this._options.contentScroll):this._options.contentScroll,this._contentZoom="string"==typeof this._options.contentZoom?document.getElementById(this._options.contentZoom):this._options.contentZoom,this._page="string"==typeof this._options.page?document.getElementById(this._options.page):this._options.page,this._debug="string"==typeof this._options.debug?document.getElementById(this._options.debug):this._options.debug,!(this._contentView&&this._bounds&&this._contentScroll&&this._contentZoom&&this._page))throw"DOM Elements undefined";this.init(this._options.zoomFit)}return PagePanPinch.prototype.init=function(scale){this._init=!1,this._initInterval=setInterval(this.initInterval,10),this._initScale=scale,this.initInterval()},PagePanPinch.prototype.refresh=function(){this.destroy(),this.init(this._options.zoomFit)},PagePanPinch.prototype.zoom=function(direction){"in"===direction?this._scale.current+=this._options.zoomIncrements:this._scale.current-=this._options.zoomIncrements,this._scale.last=this._scale.current,this.update()},PagePanPinch.prototype.zoomFit=function(value){this._options.zoomFit=value,value||(this._scale.last=this._scale.current=1,this._scale.max=2,this._scale.min=.5,this._scrollBars=!0),this.refresh()},PagePanPinch.prototype.destroy=function(){try{window.removeEventListener("mousemove",this._eventScrollMouseMove,!1),window.removeEventListener("mouseup",this._eventScrollMouseMove,!1),this._contentView.removeEventListener("mousewheel",this._eventScrollWheel,!1),this._contentView.removeEventListener("scroll",this._eventScroll,!1),this._scrollEvents=!1}catch(e){}try{this._scrollContainer&&(this._scrollContainer.parentNode.removeChild(this._scrollContainer),this._scrollContainer=void 0)}catch(e){}},PagePanPinch.prototype.getScale=function(){return this._scale.current},PagePanPinch.prototype.setupScrollbars=function(){var _this=this;if(this._scrollBars=!1,"contain"!==this._options.zoomFit&&!0!==this._options.zoomFit&&this._options.scrollBars&&(this._scrollBounds=this.getBoundingClientRect(this._contentView.getBoundingClientRect()),this._scrollRect=this.getBoundingClientRect(this._contentScroll.getBoundingClientRect()),this._scrollRect.height=this._scrollRect.height*this._scale.current,this._scrollRect.width=this._scrollRect.width*this._scale.current,(this._scrollBounds.height<this._scrollRect.height||this._scrollBounds.width<this._scrollRect.width)&&(this._scrollBars=!0),this._scrollBars)){var showAxis=[];this._scrollBounds.height<this._scrollRect.height&&showAxis.push("y"),this._scrollBounds.width<this._scrollRect.width&&showAxis.push("x"),this._scrollEvents=showAxis;var this_1=this;for(var element in this._scrollBarElements)!function(element){if(!this_1._scrollBarElements.hasOwnProperty(element))return"continue";var axis=this_1._scrollBarElements[element].axis,e=document.createElement("div");e.className=this_1._options.prefix+" "+this_1._options.prefix+"-"+this_1._scrollBarElements[element].className,e.style.position="absolute",e.style.zIndex=this_1._scrollBarElements[element].zIndex,e.addEventListener("mousedown",function(evt){"scroller"===_this._scrollBarElements[element].type?(_this._scrollBarElements[element].pos.mouseX=evt.x,_this._scrollBarElements[element].pos.mouseY=evt.y,_this._scrollBarElements[element].pos.x=parseFloat(_this._scrollBarElements[element].element.style.left),_this._scrollBarElements[element].pos.y=parseFloat(_this._scrollBarElements[element].element.style.top),_this._scrollBarElements[element].drag=!0,evt.stopPropagation()):_this.onClickScrollbar(_this._scrollBarElements[element],evt)}),this_1._scrollBarElements[element].element=e;var className=-1!==showAxis.indexOf(axis)?this_1._options.prefix+"-show":this_1._options.prefix+"-hide";e.className=this_1.removeClassname(e.className,this_1._options.prefix+"-show"),e.className=this_1.removeClassname(e.className,this_1._options.prefix+"-hide"),e.className=this_1.addClassname(e.className,className);var offset=0;switch(this_1._options.scrollBarsInset&&(offset=this_1._options.scrollBarWidth),this_1._scrollBarElements[element].type){case"scroller":var xWidth=Math.floor(this_1._scrollBounds.width/this_1._scrollRect.width*this_1._scrollBounds.width),yHeight=Math.floor(this_1._scrollBounds.height/this_1._scrollRect.height*this_1._scrollBounds.height);-1===showAxis.indexOf("x")&&(xWidth=0),-1===showAxis.indexOf("y")&&(yHeight=0),this_1._scrollBarElements[element].length="x"===axis?xWidth:yHeight,e.style.left="0px",e.style.top="0px",e.style.width="x"===axis?xWidth+"px":this_1._options.scrollBarWidth+"px",e.style.height="x"===axis?this_1._options.scrollBarWidth+"px":yHeight+"px";break;default:"x"===axis?(e.style.left=this_1._contentView.offsetLeft+"px",e.style.top=this_1._contentView.offsetTop+this_1._scrollBounds.height+offset+"px"):(e.style.left=this_1._contentView.offsetLeft+this_1._scrollBounds.width+offset+"px",e.style.top=this_1._contentView.offsetTop+"px"),e.style.width="x"===axis?this_1._scrollBounds.width+"px":this_1._options.scrollBarWidth+"px",e.style.height="x"===axis?this_1._options.scrollBarWidth+"px":this_1._scrollBounds.height+"px"}}(element);this._scrollContainer||(this._scrollContainer=document.createElement("div"),this._scrollBarElements.trackX.element.appendChild(this._scrollBarElements.scrollX.element),this._scrollBarElements.trackY.element.appendChild(this._scrollBarElements.scrollY.element),this._scrollContainer.appendChild(this._scrollBarElements.trackX.element),this._scrollContainer.appendChild(this._scrollBarElements.trackY.element)),this._bounds.appendChild(this._scrollContainer),window.addEventListener("mousemove",this._eventScrollMouseMove,!1),window.addEventListener("mouseup",this._eventScrollMouseUp,!1),this._contentView.addEventListener("mousewheel",this._eventScrollWheel,!1)}},PagePanPinch.prototype.setupContainers=function(){this._contentView.style.overflow="hidden",this._contentView.addEventListener("scroll",this._eventScroll,!1),this._contentScroll.style.width=this._page.clientWidth+"px",this._contentScroll.style.height=this._page.clientHeight+"px",this._contentZoom.style.transformOrigin="0 0"},PagePanPinch.prototype.setupTouch=function(){this._mc&&this._mc.destroy(),this._mc=new Hammer(this._contentView);var pan=new Hammer.Pan,tap=new Hammer.Tap({event:"singletap"}),doubleTap=new Hammer.Tap({event:"doubletap",taps:2});doubleTap.recognizeWith(tap);var pinch=new Hammer.Pinch;this._mc.add([pan,doubleTap,pinch]),this._scrollEvents||(this._mc.on("pinchstart",this._eventPinchStart),this._mc.on("pinchmove",this._eventPinchMove),this._mc.on("pinchend",this._eventPinchEnd)),this._mc.on("tap",this._eventTap),this._options.disablePan||(this._mc.on("panstart",this._eventPanStart),this._mc.on("panmove",this._eventPanMove),this._mc.on("panend",this._eventPanEnd))},PagePanPinch.prototype.onClickScrollbar=function(element,evt){var scroller=this._scrollBarElements["scroll"+element.axis.toUpperCase()],params=this._scrollParams[element.axis],scrollerPos=parseFloat(scroller.element.style[params.dir])+scroller.length,delta=evt[element.axis]>scrollerPos;this._pos[element.axis].current=this._pos[element.axis].last=delta?this._scrollRect[params.unit]-this._scrollBounds[params.unit]:0,this.update()},PagePanPinch.prototype.clearPanTimer=function(){this._panTimer&&clearInterval(this._panTimer)},PagePanPinch.prototype.updatePanVel=function(){this._pos.x.current+=this._pos.x.delta,this._pos.y.current+=this._pos.y.delta,this._pos.x.last=this._pos.x.current,this._pos.y.last=this._pos.y.current,this._pos.x.delta*=this._pos.friction,this._pos.y.delta*=this._pos.friction,this.update(),Math.abs(this._pos.x.delta)<.01&&Math.abs(this._pos.y.delta)<.01&&clearInterval(this._panTimer)},PagePanPinch.prototype.update=function(){this.setWithinBounds(),this._contentView.scrollLeft=this._pos.x.current,this._contentView.scrollTop=this._pos.y.current,this._contentZoom.style.transform=this._options.zoomCss?"translateZ(0px)":"translateZ(0px) scale("+this._scale.current+")",this._options.zoomCss&&(this._contentZoom.style.zoom=100*this._scale.current+"%"),this.updateScrollbars()},PagePanPinch.prototype.updateScrollbars=function(){if(this._scrollBars&&this._scrollEvents)for(var e in this._scrollParams)if(this._scrollParams.hasOwnProperty(e)){var param=this._scrollParams[e],maxScroll=this._scrollRect[param.unit]-this._scrollBounds[param.unit],scrollDistance=this._scrollBounds[param.unit]-this._scrollBarElements[param.element].length,pos=this._pos[e].current*scrollDistance/maxScroll;this._scrollBarElements[param.element].element.style[param.dir]=pos+"px"}},PagePanPinch.prototype.updateContentScroll=function(){this._contentScroll.style.width=Math.ceil(this._scale.width)+"px",this._contentScroll.style.height=Math.ceil(this._scale.height)+"px"},PagePanPinch.prototype.setMaxMinScale=function(scale){var scaleWidth=this._contentView.clientWidth/this._page.clientWidth,scaleHeight=this._contentView.clientHeight/this._page.clientHeight,scaleBy=scaleHeight<scaleWidth?scaleHeight:scaleWidth;"width"===this._options.zoomFit&&(scaleBy=scaleWidth),"height"===this._options.zoomFit&&(scaleBy=scaleHeight),this._scale.last=this._scale.current=scaleBy,this._scale.min=scaleBy,this._scale.max=scaleBy<1?2:2*scaleBy},PagePanPinch.prototype.setWithinBounds=function(){this._scale.current>this._scale.max&&(this._scale.current=this._scale.max),this._scale.current<this._scale.min&&(this._scale.current=this._scale.min);var pageWidth=this._page.clientWidth*this._scale.current,pageHeight=this._page.clientHeight*this._scale.current;this._scale.width=pageWidth,this._scale.height=pageHeight;var maxLeft=pageWidth-this._contentView.clientWidth,maxTop=pageHeight-this._contentView.clientHeight;this._pos.x.max=maxLeft,this._pos.x.min=0,this._pos.y.max=maxTop,this._pos.y.min=0,pageWidth>this._contentView.clientWidth?this._pos.x.current>maxLeft?this._pos.x.current=maxLeft:this._pos.x.current<0&&(this._pos.x.current=0):this._pos.x.current=0,pageHeight>this._contentView.clientHeight?this._pos.y.current>maxTop?this._pos.y.current=maxTop:this._pos.y.current<0&&(this._pos.y.current=0):this._pos.y.current=0,this._debug&&(this._debug.innerHTML='\n                <table>\n                    <tr>\n                        <td width="100">x</td>\n                        <td align="right">'+this._pos.x.current.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>y</td>\n                        <td align="right">'+this._pos.y.current.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>width</td>\n                        <td align="right">'+pageWidth.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>height</td>\n                        <td align="right">'+pageHeight.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>scale</td>\n                        <td align="right">'+this._scale.last.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>bounds height</td>\n                        <td align="right">'+this._contentView.clientHeight.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>bounds width</td>\n                        <td align="right">'+this._contentView.clientWidth.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>page height</td>\n                        <td align="right">'+this._page.clientHeight.toFixed(2)+'</td>\n                    </tr>\n                    <tr>\n                        <td>page width</td>\n                        <td align="right">'+this._page.clientWidth.toFixed(2)+"</td>\n                    </tr>\n                </table>\n            ")},PagePanPinch.prototype.addClassname=function(currentName,name){return(this.removeClassname(currentName,name)+" "+name).trim()},PagePanPinch.prototype.removeClassname=function(currentName,name){var exp=new RegExp(""+name,"ig");return currentName.replace(exp,"").trim()},PagePanPinch.prototype.getBoundingClientRect=function(rect){return{top:rect.top,right:rect.right,bottom:rect.bottom,left:rect.left,width:rect.width,height:rect.height,x:rect.x,y:rect.y}},PagePanPinch}();